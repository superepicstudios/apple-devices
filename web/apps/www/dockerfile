FROM denoland/deno:alpine AS build
WORKDIR /app
USER deno
COPY . .
RUN deno install --allow-scripts
CMD ["deno", "task", "build"]

FROM busybox:stable AS run
RUN adduser -D www
USER www
WORKDIR /home/www/app
COPY --from=build /app/web/apps/www/.vitepress/dist .
EXPOSE 5173
CMD ["busybox", "httpd", "-f", "-v", "-p", "5173"]