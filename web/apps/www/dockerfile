FROM denoland/deno:alpine AS build
WORKDIR /app
USER deno
COPY . .
RUN deno install --allow-scripts
CMD ["deno", "task", "build"]

FROM busybox:stable AS run
WORKDIR /app
COPY --from=build /app/web/apps/www/.vitepress/dist .
CMD ["busybox", "httpd", "-f", "-v", "-p", "5173"]
